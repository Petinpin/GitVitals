generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id              String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email           String          @unique
  name            String
  role            user_role
  canvasId        String?         @map("canvas_id")
  createdAt       DateTime        @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt       DateTime        @default(now()) @map("updated_at") @db.Timestamptz(6)
  createdVitals   CorrectVitals[] @relation("CreatedByUser")
  patients        Patient[]
  students        Student?
  enteredReadings VitalReadings[]  @relation("EnteredByUser")

  @@map("users")
}

model Student {
  id            String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId        String         @unique @map("user_id") @db.Uuid
  studentId     String?        @map("student_id")
  cohort        String?
  createdAt     DateTime       @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt     DateTime       @default(now()) @map("updated_at") @db.Timestamptz(6)
  patients      Patient[]
  user          User           @relation(fields: [userId], references: [id])
  vitalReadings VitalReadings[]

  @@map("students")
}

model Patient {
  id            String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  studentId     String?         @map("student_id") @db.Uuid
  userId        String?        @map("user_id") @db.Uuid
  name          String
  relationship  String?
  age           Int?
  gender        String?
  isBaselineSet Boolean        @default(false) @map("is_baseline_set")
  createdAt     DateTime       @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt     DateTime       @default(now()) @map("updated_at") @db.Timestamptz(6)
  correctVitals CorrectVitals?
  student       Student?        @relation(fields: [studentId], references: [id])
  user          User?          @relation(fields: [userId], references: [id])
  vitalReadings VitalReadings[]

  @@map("patients")
}

model CorrectVitals {
  id               String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  patientId        String   @unique @map("patient_id") @db.Uuid
  bloodPressureSys Int      @map("blood_pressure_sys")
  bloodPressureDia Int      @map("blood_pressure_dia")
  heartRate        Int      @map("heart_rate")
  temperature      Decimal  @db.Decimal
  respiratoryRate  Int      @map("respiratory_rate")
  oxygenSaturation Int      @map("oxygen_saturation")
  createdById      String   @map("created_by_id") @db.Uuid
  createdAt        DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  createdBy        User     @relation("CreatedByUser", fields: [createdById], references: [id])
  patient          Patient  @relation(fields: [patientId], references: [id])

  @@map("correct_vitals")
}

model VitalReadings {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  patientId        String    @map("patient_id") @db.Uuid
  studentId        String    @map("student_id") @db.Uuid
  enteredById      String    @map("entered_by_id") @db.Uuid
  enteredByRole    user_role @map("entered_by_role")
  readingNumber    Int       @map("reading_number")
  bloodPressureSys Int       @map("blood_pressure_sys")
  bloodPressureDia Int       @map("blood_pressure_dia")
  heartRate        Int       @map("heart_rate")
  temperature      Decimal   @db.Decimal
  respiratoryRate  Int       @map("respiratory_rate")
  oxygenSaturation Int       @map("oxygen_saturation")
  submittedAt      DateTime  @default(now()) @map("submitted_at") @db.Timestamptz(6)
  isCorrect        Boolean   @default(false) @map("is_correct")
  mlPrediction     Int?      @map("ml_prediction")
  mlRiskScore      Decimal?  @map("ml_risk_score") @db.Decimal
  mlConfidence     Decimal?  @map("ml_confidence") @db.Decimal
  enteredBy        User      @relation("EnteredByUser", fields: [enteredById], references: [id])
  patient          Patient   @relation(fields: [patientId], references: [id])
  student          Student   @relation(fields: [studentId], references: [id])

  @@map("vital_readings")
}

enum user_role {
  STUDENT
  INSTRUCTOR
}
